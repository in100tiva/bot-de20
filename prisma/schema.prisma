// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Modelo de usuários/participantes
model User {
  id          String       @id @default(cuid())
  discordId   String       @unique
  username    String
  points      Int          @default(0)
  streak      Int          @default(0)
  lastActive  DateTime     @default(now())
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  
  submissions Submission[]
  badges      UserBadge[]
  
  @@map("users")
}

// Modelo de desafios
model Challenge {
  id            Int          @id @default(autoincrement())
  title         String
  description   String       @db.Text
  difficulty    Difficulty
  requirements  String[]
  active        Boolean      @default(true)
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  
  submissions   Submission[]
  dailyPosts    DailyPost[]
  
  @@map("challenges")
}

// Modelo de submissões/entregas
model Submission {
  id          String           @id @default(cuid())
  userId      String
  challengeId Int
  url         String
  status      SubmissionStatus @default(PENDING)
  feedback    String?          @db.Text
  points      Int              @default(0)
  submittedAt DateTime         @default(now())
  reviewedAt  DateTime?
  
  user        User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  challenge   Challenge        @relation(fields: [challengeId], references: [id], onDelete: Cascade)
  
  @@map("submissions")
  @@index([userId])
  @@index([challengeId])
  @@index([status])
}

// Modelo de postagens diárias
model DailyPost {
  id            String    @id @default(cuid())
  challengeId   Int
  postedAt      DateTime  @default(now())
  channelId     String
  messageId     String
  
  challenge     Challenge @relation(fields: [challengeId], references: [id], onDelete: Cascade)
  
  @@map("daily_posts")
  @@index([postedAt])
}

// Modelo de badges/conquistas
model Badge {
  id          String      @id @default(cuid())
  name        String      @unique
  description String
  icon        String
  requirement Int         // Número necessário para conquistar
  type        BadgeType
  createdAt   DateTime    @default(now())
  
  users       UserBadge[]
  
  @@map("badges")
}

// Relação usuário-badge (muitos para muitos)
model UserBadge {
  id         String   @id @default(cuid())
  userId     String
  badgeId    String
  earnedAt   DateTime @default(now())
  
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  badge      Badge    @relation(fields: [badgeId], references: [id], onDelete: Cascade)
  
  @@unique([userId, badgeId])
  @@map("user_badges")
  @@index([userId])
}

// Enums
enum Difficulty {
  FACIL
  MEDIO
  DIFICIL
}

enum SubmissionStatus {
  PENDING
  APPROVED
  REJECTED
  IN_REVIEW
}

enum BadgeType {
  PARTICIPATION  // Por número de desafios
  STREAK         // Por dias consecutivos
  SPECIAL        // Conquistas especiais
  ACHIEVEMENT    // Conquistas gerais
}

